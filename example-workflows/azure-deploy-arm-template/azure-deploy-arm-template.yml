version: v1
description: Azure Resource Test
parameters:
  TenantID:
    description: Your Azure Tenant ID
  ApplicationID:
    description: The Application (Client) ID of your Service Principal
  DeploymentName:
    description: The name for this particular deployment
  ResourceGroupName:
    description: The resource group that this deployment will be associated with
  templateFilename:
    description: The full path to the partciular ARM template you want to run
  FolderName:
    description: The folder name for the local git clone
  RepoURL:
    description: The URL to the git repository that contains the ARM template file
  StorageAccountName:
    description: The name to use for the storage account. This must be unique and only contains lowercase letters and numbers
  gitBranch:
    description: The git branch
steps:
- name: azureresourcemanager-deployer
  image: projectnebula/azureresourcemanager-deployer:latest
  spec:
    azure:
      tenantID: !Parameter TenantID
      username: !Parameter ApplicationID
      cert:
        $type: Secret
        name: cert
    deploymentName: !Parameter DeploymentName
    resourceGroup: !Parameter ResourceGroupName
    templateFile: !Parameter templateFilename
    git:
      name: !Parameter FolderName
      branch: !Parameter gitBranch
      repository: !Parameter RepoURL
    parameters:
      storageName: !Parameter StorageAccountName